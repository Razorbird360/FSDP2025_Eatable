generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                        String            @id @default(uuid()) @db.Uuid
  email                     String            @unique
  displayName               String            @map("display_name")
  role                      String            @default("user")
  createdAt                 DateTime          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                 DateTime          @updatedAt @map("updated_at") @db.Timestamptz(6)
  username                  String            @unique
  skipOnboarding            Boolean           @default(false) @map("skip_Onboarding")
  first_name                String?
  last_name                 String?
  location                  String?
  description               String?
  verified                  Boolean?
  verification_photo_url    String?
  verification_submitted_at DateTime?         @db.Timestamptz(6)
  phone                     String?
  language                  String?
  reports                   ContentReport[]
  votes                     MediaUploadVote[]
  mediaUploads              MediaUpload[]
  orders                    Order[]
  ownedStalls               Stall[]
  user_cart                 user_cart[]
  favorites                 UserFavorite[]

  @@map("users")
}

model Stall {
  id             String         @id @default(uuid()) @db.Uuid
  ownerId        String?        @map("owner_id") @db.Uuid
  name           String         @unique
  description    String?
  location       String?
  cuisineType    String?        @map("cuisine_type")
  tags           String[]       @default([])
  createdAt      DateTime       @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt      DateTime       @updatedAt @map("updated_at") @db.Timestamptz(6)
  image_url      String?
  hawkerCentreId String?        @map("hawker_centre_id") @db.Uuid
  menuItems      MenuItem[]
  orders         Order[]
  hawkerCentre   HawkerCentre?  @relation(fields: [hawkerCentreId], references: [id], onUpdate: NoAction)
  owner          User?          @relation(fields: [ownerId], references: [id])
  favorites      UserFavorite[]

  @@map("stalls")
}

model MenuItem {
  id           String         @id @default(uuid()) @db.Uuid
  stallId      String         @map("stall_id") @db.Uuid
  name         String
  description  String?
  priceCents   Int            @map("price_cents")
  category     String?
  prepTimeMins Int?           @map("prep_time_mins")
  isActive     Boolean        @default(true) @map("is_active")
  createdAt    DateTime       @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime       @updatedAt @map("updated_at") @db.Timestamptz(6)
  imageUrl     String?        @map("image_url")
  mediaUploads MediaUpload[]
  stall        Stall          @relation(fields: [stallId], references: [id], onDelete: Cascade)
  orderItems   OrderItem[]
  user_cart    user_cart[]
  favorites    UserFavorite[]

  @@unique([stallId, name])
  @@map("menu_items")
}

model MediaUpload {
  id                String            @id @default(uuid()) @db.Uuid
  menuItemId        String            @map("menu_item_id") @db.Uuid
  userId            String            @map("user_id") @db.Uuid
  imageUrl          String            @map("image_url")
  caption           String?
  validationStatus  String            @default("pending") @map("validation_status")
  rejectionReason   String?           @map("rejection_reason")
  aiConfidenceScore Float?            @map("ai_confidence_score")
  reviewedAt        DateTime?         @map("reviewed_at") @db.Timestamptz(6)
  reviewedBy        String?           @map("reviewed_by") @db.Uuid
  upvoteCount       Int               @default(0) @map("upvote_count")
  downvoteCount     Int               @default(0) @map("downvote_count")
  voteScore         Int               @default(0) @map("vote_score")
  createdAt         DateTime          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime          @updatedAt @map("updated_at") @db.Timestamptz(6)
  aspectRatio       String?           @map("aspect_ratio")
  reports           ContentReport[]
  votes             MediaUploadVote[]
  menuItem          MenuItem          @relation(fields: [menuItemId], references: [id], onDelete: Cascade)
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("media_uploads")
}

model MediaUploadVote {
  uploadId  String      @map("upload_id") @db.Uuid
  userId    String      @map("user_id") @db.Uuid
  vote      Int         @db.SmallInt
  createdAt DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime    @updatedAt @map("updated_at") @db.Timestamptz(6)
  upload    MediaUpload @relation(fields: [uploadId], references: [id], onDelete: Cascade)
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([uploadId, userId])
  @@map("media_upload_votes")
}

model Order {
  id                 String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId             String              @map("user_id") @db.Uuid
  stallId            String              @map("stall_id") @db.Uuid
  status             String              @default("pending")
  totalCents         Int                 @default(0) @map("total_cents")
  netsTxnId          String?             @map("nets_txn_id")
  estimatedReadyTime DateTime?           @map("estimated_ready_time") @db.Timestamptz(6)
  completedAt        DateTime?           @map("completed_at") @db.Timestamptz(6)
  createdAt          DateTime            @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime            @updatedAt @map("updated_at") @db.Timestamptz(6)
  discounts_charges  discounts_charges[]
  orderItems         OrderItem[]
  stall              Stall               @relation(fields: [stallId], references: [id], onDelete: Cascade)
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("orders")
}

model OrderItem {
  id         String   @id @default(uuid()) @db.Uuid
  orderId    String   @map("order_id") @db.Uuid
  menuItemId String   @map("menu_item_id") @db.Uuid
  quantity   Int      @default(1)
  unitCents  Int      @map("unit_cents")
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
  request    String?  @default("")
  menuItem   MenuItem @relation(fields: [menuItemId], references: [id])
  order      Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("order_items")
}

model UserFavorite {
  id         String    @id @default(uuid()) @db.Uuid
  userId     String    @map("user_id") @db.Uuid
  menuItemId String?   @map("menu_item_id") @db.Uuid
  stallId    String?   @map("stall_id") @db.Uuid
  createdAt  DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  menuItem   MenuItem? @relation(fields: [menuItemId], references: [id], onDelete: Cascade)
  stall      Stall?    @relation(fields: [stallId], references: [id], onDelete: Cascade)
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, menuItemId])
  @@unique([userId, stallId])
  @@map("user_favorites")
}

model ContentReport {
  id         String      @id @default(uuid()) @db.Uuid
  uploadId   String      @map("upload_id") @db.Uuid
  reporterId String      @map("reporter_id") @db.Uuid
  reason     String
  status     String      @default("pending")
  createdAt  DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime    @updatedAt @map("updated_at") @db.Timestamptz(6)
  details    String      @default("")
  reporter   User        @relation(fields: [reporterId], references: [id], onDelete: Cascade)
  upload     MediaUpload @relation(fields: [uploadId], references: [id], onDelete: Cascade)

  @@map("content_reports")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model user_cart {
  created_at DateTime  @default(now()) @db.Timestamptz(6)
  userid     String?   @db.Uuid
  itemid     String?   @db.Uuid
  qty        Int?
  request    String?
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  menu_items MenuItem? @relation(fields: [itemid], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users      User?     @relation(fields: [userid], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model HawkerCentre {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String
  slug       String   @unique
  address    String?
  postalCode String?  @map("postal_code")
  latitude   Float
  longitude  Float
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  stalls     Stall[]

  @@map("hawker_centres")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model system_configuration {
  id              BigInt   @id @default(autoincrement())
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  servicefeecents Int?     @default(0)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model discounts_charges {
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  type        String?
  orderId     String?  @db.Uuid
  amountCents Float?   @db.Real
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  orders      Order?   @relation(fields: [orderId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}
